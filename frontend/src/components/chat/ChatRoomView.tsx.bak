'use client'

import { useState } from 'react'
import useChatroom from '@/hooks/useChatroom'

export default function ChatRoomView({ chatroomId }: { chatroomId: number }) {
  const { messages, send, reconnect } = useChatroom(chatroomId)
  const [text, setText] = useState('')

  return (
    <div className="flex flex-col h-[calc(100vh-120px)] border rounded">
      <div className="flex-1 overflow-y-auto p-4 space-y-2">
        {messages.map((m) => (
          <div key={m.messageId} className="rounded p-2 border">
            <div className="text-xs opacity-60">
              #{m.messageId} · {new Date(m.createdAt).toLocaleString()}
            </div>
            <div>{m.content}</div>
          </div>
        ))}
      </div>
      <form
        onSubmit={(e) => {
          e.preventDefault()
          send(text)
          setText('')
        }}
        className="p-2 border-t flex gap-2"
      >
        <input
          className="flex-1 border px-2"
          value={text}
          onChange={(e) => setText(e.target.value)}
          placeholder="메시지를 입력하세요"
        />
        <button className="border px-3">Send</button>
        <button type="button" className="border px-3 text-sm" onClick={reconnect}>
          Reconnect
        </button>
      </form>
    </div>
  )
}
